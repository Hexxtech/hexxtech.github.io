<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ServerSeed List View (IndexedDB)</title>
  <style>
    body {
      margin: 1rem;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h2 {
      margin-bottom: 1rem;
    }
    #controls {
      max-width: 480px;
      width: 100%;
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    #searchInput {
      flex: 1 1 auto;
      min-width: 100px;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #444;
      background-color: #222;
      color: #eee;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #0078d7;
      color: white;
      user-select: none;
      min-width: 110px;
    }
    button:disabled {
      background-color: #555;
      cursor: default;
    }
    #serverSeedList {
      width: 100%;
      max-width: 480px;
      height: 220px;
      overflow-y: auto;
      background-color: #222;
      border: 1px solid #444;
      padding: 0;
      list-style: none;
      border-radius: 6px;
      margin-bottom: 1rem;
    }
    #serverSeedList li {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #333;
      cursor: pointer;
      user-select: none;
      font-family: monospace;
      font-size: 0.875rem;
    }
    #serverSeedList li:hover {
      background-color: #333;
    }
    #serverSeedList li.selected {
      background-color: #0078d7;
      color: white;
    }
    label {
      font-weight: 600;
      align-self: flex-start;
      margin-left: calc(50% - 240px);
      max-width: 480px;
      margin-bottom: 0.25rem;
    }
    #hashedValue {
      width: 100%;
      max-width: 480px;
      min-height: 4rem;
      font-family: monospace;
      font-size: 1rem;
      padding: 0.75rem 1rem;
      background-color: #222;
      color: #eee;
      border: 1px solid #444;
      border-radius: 6px;
      resize: none;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      margin-bottom: 1rem;
    }
    @media (max-width: 520px) {
      body {
        margin: 0.5rem;
      }
      label {
        margin-left: 0;
      }
      #serverSeedList, #hashedValue, button {
        max-width: 100%;
      }
      #controls {
        gap: 0.25rem;
      }
    }
  </style>
</head>
<body>

  <h2>ServerSeed List View (IndexedDB)</h2>

  <div id="controls">
    <input id="searchInput" type="text" placeholder="Search serverSeed or hashed value" aria-label="Search serverSeed or hashed value" />
    <button id="copyHashedBtn" disabled>Copy Hashed Value</button>
  </div>

  <label for="serverSeedList">Server Seeds:</label>
  <ul id="serverSeedList" role="listbox" tabindex="0" aria-label="Server Seeds"></ul>

  <label for="hashedValue">Matching ServerSeedHashed:</label>
  <textarea id="hashedValue" readonly aria-live="polite" aria-label="ServerSeed Hashed Value"></textarea>

<script>
  const DB_NAME = "serverSeedDb";
  const DB_VERSION = 1;
  const STORE_NAME = "seeds";

  const defaultSeeds = [
    {
      serverSeed: "01707b9930c0bba21babd5147aceac2ee18d3136abdafb099e714e7987f4aafc",
      serverSeedHashed: "407ca67c38df3580b0e1e90ddd414047d93ef33bbb0ba8da0c741d164abf918a"
    },
    {
      serverSeed: "11a560e32e5f50c3f0354602eb16153e70e3233e0fc2461e358dbcd82987e2de",
      serverSeedHashed: "a92037341f61813cb30c573cbf5616db6f42729811a1325a89cf17bec4a5dadc"
    }
  ];

  let db;
  let serverSeedDataArr = [];
  let filteredData = [];
  let selectedIndex = -1;

  const serverSeedList = document.getElementById('serverSeedList');
  const hashedValue = document.getElementById('hashedValue');
  const copyHashedBtn = document.getElementById('copyHashedBtn');
  const searchInput = document.getElementById('searchInput');

  function openDb() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, DB_VERSION);
      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        db = request.result;
        resolve(db);
      };
      request.onupgradeneeded = (e) => {
        db = e.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          const store = db.createObjectStore(STORE_NAME, { keyPath: "serverSeed" });
          store.createIndex("serverSeedHashed", "serverSeedHashed", { unique: false });
        }
      };
    });
  }

  function addSeed(seed) {
    return new Promise((resolve, reject) => {
      const tx = db.transaction(STORE_NAME, "readwrite");
      const store = tx.objectStore(STORE_NAME);
      const request = store.add(seed);
      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }

  function getAllSeeds() {
    return new Promise((resolve, reject) => {
      const tx = db.transaction(STORE_NAME, "readonly");
      const store = tx.objectStore(STORE_NAME);
      const request = store.getAll();
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  function copyToClipboard(text) {
    return navigator.clipboard.writeText(text);
  }

  function populateList() {
    serverSeedList.innerHTML = '';
    filteredData.forEach((item, idx) => {
      const li = document.createElement('li');
      li.textContent = item.serverSeed;
      li.setAttribute('role', 'option');
      li.tabIndex = -1;
      li.dataset.index = idx;
      li.addEventListener('click', () => {
        selectItem(idx);
      });
      serverSeedList.appendChild(li);
    });
    if (filteredData.length === 0) {
      selectItem(-1);
    } else if (selectedIndex >= filteredData.length || selectedIndex === -1) {
      selectItem(0);
    } else {
      selectItem(selectedIndex);
    }
  }

  function selectItem(index) {
    if (selectedIndex >= 0 && serverSeedList.children[selectedIndex]) {
      serverSeedList.children[selectedIndex].classList.remove('selected');
    }
    selectedIndex = index;
    if (selectedIndex === -1) {
      hashedValue.value = '';
      copyHashedBtn.disabled = true;
      return;
    }
    const selectedItem = serverSeedList.children[selectedIndex];
    selectedItem.classList.add('selected');
    selectedItem.focus();
    hashedValue.value = filteredData[selectedIndex].serverSeedHashed;
    copyHashedBtn.disabled = false;
  }

  serverSeedList.addEventListener('keydown', (e) => {
    if (filteredData.length === 0) return;
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      let nextIndex = selectedIndex + 1;
      if (nextIndex >= filteredData.length) nextIndex = 0;
      selectItem(nextIndex);
      serverSeedList.children[nextIndex].scrollIntoView({ block: 'nearest' });
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      let prevIndex = selectedIndex - 1;
      if (prevIndex < 0) prevIndex = filteredData.length - 1;
      selectItem(prevIndex);
      serverSeedList.children[prevIndex].scrollIntoView({ block: 'nearest' });
    }
  });

  copyHashedBtn.addEventListener('click', async () => {
    if (selectedIndex === -1) return;
    const textToCopy = filteredData[selectedIndex].serverSeedHashed;
    try {
      await copyToClipboard(textToCopy);
      alert('Hashed value copied to clipboard.');
    } catch {
      alert('Failed to copy. Please copy manually.');
    }
  });

  function applyFilter() {
    const query = searchInput.value.trim().toLowerCase();
    if (query === '') {
      filteredData = serverSeedDataArr.slice();
    } else {
      filteredData = serverSeedDataArr.filter(item =>
        item.serverSeed.toLowerCase().includes(query) ||
        item.serverSeedHashed.toLowerCase().includes(query)
      );
    }
    populateList();
  }

  searchInput.addEventListener('input', () => {
    applyFilter();
  });

  async function loadData() {
    db = await openDb();
    let seeds = await getAllSeeds();
    if (seeds.length === 0) {
      // Add default seeds if DB empty
      for (const seed of defaultSeeds) {
        await addSeed(seed);
      }
      seeds = await getAllSeeds();
    }
    serverSeedDataArr = seeds;
    applyFilter();
    if (filteredData.length > 0) selectItem(0);
  }

  window.addEventListener('DOMContentLoaded', () => {
    loadData().catch(e => {
      alert('Failed to initialize IndexedDB: ' + e.message);
    });
  });
</script>
</body>
</html>
